function getRenderTarget(a,b){var c=new THREE.WebGLMultiRenderTarget(a,b);c.texSize=new THREE.Vector2(a,b),c.texture.format=THREE.RGBAFormat,c.texture.minFilter=THREE.LinearFilter,c.texture.magFilter=THREE.LinearFilter,c.texture.type=THREE.FloatType,c.texture.generateMipmaps=!1,c.stencilBuffer=!1,c.depthBuffer=!0;var d=c.texture.clone();return c.attachments.push(d),c.attachments[0].name="diffuse",c.attachments[1].name="scratchpad",c}DATA={TextPages:[["If there is no struggle, there is no progress."].join("\n"),["Those who profess to favor freedom, and yet","deprecate agitation, are people who want rain","without thunder and lightning. They want the ","ocean without the roar of its many waters."].join("\n"),["Power concedes nothing without a demand. ","It never did and it never will.","","           Frederick Douglass, ","           slavery abolitionist, 1818-1895"].join("\n"),["This demo is dedicated to all the activists of 269Life"].join("\n"),["The raymarching based renderings used in this","demo are based on the 'pseudo kleinian' algorithm","by Knighty (see Fragmentarium examples). Variations","of the used 'distance functions' were derived by","experimentation and inspired by different work in the","http://www.fractalforums.com (e.g. by Crist-JRoger, et al.)"].join("\n"),["This page would not have been possible without the many","clever algorithms for things like: Blinn Phong reflection,","ambient occlusion, bokeh, random noise, etc (see source code","for more detailed references). THREE.js removed many of the","WEBGL pains."].join("\n"),["Thanks also go to Marius for his  'boxplorer2' which provided","a valuable reference and was used to edit the camera paths","used here. Good luck with your next generation VR stuff :-)"].join("\n"),["Further credits: ","","Music: 'Dark Grey' by Wright & Bastard","       'Ashley Walbridge Arica(Darkmelo Edit)' by Darkmelo","","Fonts: '1942 report' from fontsquirrel.com","       'Vertigo' by Brian Kent","       'Mountains of Christmas' from fonts.google.com"].join("\n"),["Copyright (C) 2017 Juergen Wothke"].join("\n"),["And now to something completely different..."].join("\n"),["You've reached the end of the guided tour and the demo ","will now enter random loop mode."].join("\n")],KeyFrameConfig:{main:{speed:.0242,loop:1,delta_time:2.61007,time:0,position:[-.475886,-3.32459,.0983495],direction:[.956488,.285832,.0585688],upDirection:[.0706284,-.421588,.904033]},keyFrames:[{speed:39507e-8,loop:1,delta_time:2.61007,time:61.1107,position:[.00456264,-3.22998,.0870265],direction:[.0479935,.321968,-.945533],upDirection:[-.892896,-.410461,-.18509]},{speed:378611e-9,loop:0,delta_time:2.82442e-8,time:0,position:[-.0068089,-3.22604,-567084e-9],direction:[-.209868,-.522238,-.826573],upDirection:[.792574,-.585904,.168945]},{speed:894737e-9,loop:0,delta_time:.136633,time:0,position:[-.039786,-3.21509,-.00284366],direction:[-.852786,-.405454,-.329185],upDirection:[.444752,-.894213,-.0507814]},{speed:874604e-9,loop:0,delta_time:.808198,time:0,position:[.154786,-3.15589,.0195536],direction:[-.94033,-.263952,-.214729],upDirection:[-.172581,-.1739,.969523]},{speed:.00363229,loop:0,delta_time:.517824,time:0,position:[.122125,-3.02948,.0311959],direction:[-.418817,-.8146,.401273],upDirection:[.326651,.277167,.903592]},{speed:.00843802,loop:0,delta_time:.53976,time:0,position:[.0451053,-2.91851,.0517434],direction:[-.0289254,-.995737,.0875841],upDirection:[-.0432025,.0887843,.995114]},{speed:.00843802,loop:0,delta_time:.772882,time:0,position:[-.150479,-2.91426,.0543293],direction:[.683447,-.7287,-.0435419],upDirection:[-.0831896,-.137004,.987071]},{speed:.00843802,loop:0,delta_time:.982164,time:0,position:[-.346111,-3.04934,.0496718],direction:[.809023,-.485251,.331682],upDirection:[-.365194,.0271835,.930534]},{speed:.00843802,loop:0,delta_time:2.23536,time:0,position:[-.462413,-3.58213,.10853],direction:[.824793,.55661,-.099507],upDirection:[.0237836,.141676,.989627]},{speed:.00843802,loop:0,delta_time:2.38873,time:0,position:[-.172903,-4.05452,.350764],direction:[.137335,.913945,-.381894],upDirection:[.24935,.341232,.906303]},{speed:.00843802,loop:0,delta_time:2.74322,time:0,position:[.477854,-3.96367,.12608],direction:[-.532705,.66698,-.520925],upDirection:[-.39483,.348572,.850063]},{speed:.00843802,loop:0,delta_time:1.62409,time:0,position:[.671771,-3.60229,.097487],direction:[-.943648,.218165,-.248861],upDirection:[-.198991,.226821,.953391]},{speed:.00294216,loop:0,delta_time:.730977,time:0,position:[.616544,-3.43696,.0353766],direction:[-.828089,-.128447,-.545683],upDirection:[-.558588,.106732,.82255]},{speed:.00156358,loop:0,delta_time:.576268,time:0,position:[.567564,-3.42771,.00874003],direction:[-.918382,.38889,-.0730626],upDirection:[-.0991209,-.0473409,.993949]},{speed:.0012665,loop:0,delta_time:.432449,time:0,position:[.528843,-3.41045,.00764268],direction:[-.948205,.314829,.0423148],upDirection:[.012663,-.0956401,.995335]},{speed:.00193035,loop:0,delta_time:1.85867,time:0,position:[.35976,-3.34447,.0245307],direction:[-.918612,.388249,-.0735841],upDirection:[-.0987547,-.0452509,.994082]},{speed:.00193035,loop:0,delta_time:.597724,time:0,position:[.31139,-3.31256,.0156934],direction:[-.832475,.531077,-.157932],upDirection:[-.0837475,.161159,.983369]},{speed:.00264794,loop:0,delta_time:.75693,time:0,position:[.245197,-3.27979,.0231455],direction:[-.88696,.341052,.311425],upDirection:[.320049,-.0322615,.946852]},{speed:.00326906,loop:0,delta_time:.641338,time:0,position:[.203001,-3.26578,.0676334],direction:[-.381403,-.0141436,.924301],upDirection:[.901461,-.227097,.368504]},{speed:.00140722,loop:0,delta_time:.456692,time:0,position:[.196967,-3.28762,.106264],direction:[-.294403,-.55847,.775524],upDirection:[.70158,-.677318,-.221417]},{speed:830953e-9,loop:0,delta_time:.468359,time:0,position:[.186204,-3.31076,.127943],direction:[-.198752,-.829133,.522529],upDirection:[.799106,-.445771,-.403383]},{speed:.00193035,loop:0,delta_time:.451985,time:0,position:[.200965,-3.3266,.145965],direction:[.0794761,-.978653,.189532],upDirection:[.839778,-.0367085,-.541688]},{speed:.00238315,loop:0,delta_time:2.39694,time:0,position:[.34737,-3.31308,.163532],direction:[-.24999,-.930063,-.269235],upDirection:[-.0860833,-.255613,.962939]},{speed:.00238315,loop:0,delta_time:1.84046,time:0,position:[.456991,-3.31639,.236238],direction:[-.50264,-.456188,-.734333],upDirection:[-.536186,-.501805,.678746]},{speed:.00679941,loop:0,delta_time:8.96508,time:0,position:[.670403,-3.76816,.526114],direction:[-.688306,.564153,-.456033],upDirection:[-.223698,.432943,.873224]},{speed:.00822728,loop:1,delta_time:2.61007,time:30.7968,position:[.547834,-3.8102,.670097],direction:[-.693308,.385133,-.609096],upDirection:[-.591707,.178222,.786206]},{speed:.00348917,loop:0,delta_time:6.235,time:0,position:[.244495,-3.47788,.472801],direction:[-.539597,.512057,-.668306],upDirection:[-.631376,.279,.723549]},{speed:830953e-9,loop:0,delta_time:2.95682,time:0,position:[.126147,-3.35645,.346559],direction:[-.581394,.631079,-.513537],upDirection:[-.357662,.368683,.857992]},{speed:.00238315,loop:0,delta_time:.693882,time:0,position:[.104181,-3.3265,.31368],direction:[-.485165,.552416,-.677829],upDirection:[-.436029,.519087,.735138]},{speed:.00238315,loop:0,delta_time:2.18262,time:0,position:[.153374,-3.19634,.243053],direction:[-.829432,-.246449,-.501303],upDirection:[-.544095,.559655,.625098]},{speed:.00238315,loop:0,delta_time:1.55746,time:0,position:[.152517,-3.11375,.168368],direction:[-.838165,-.493788,-.23163],upDirection:[-.279483,.024148,.959847]},{speed:.00238315,loop:0,delta_time:.917927,time:0,position:[.0971644,-3.08132,.182198],direction:[-.459151,-.164637,-.872969],upDirection:[-.455095,-.800344,.390304]},{speed:.00238315,loop:0,delta_time:1.99835,time:0,position:[-.0407727,-3.04412,.181049],direction:[.795118,-.46413,-.390347],upDirection:[-.0959638,-.731835,.674692]},{speed:.00238315,loop:0,delta_time:1.42602,time:0,position:[-.108238,-3.11972,.192353],direction:[.702185,-.489801,-.51675],upDirection:[.55132,-.0852142,.829931]},{speed:.00238315,loop:0,delta_time:1.9255,time:0,position:[-.170827,-3.23951,.218469],direction:[.832477,.114641,-.542069],upDirection:[.552533,-.0992178,.827564]},{speed:.00238315,loop:0,delta_time:2.18632,time:0,position:[-.118816,-3.37714,.165676],direction:[.581052,.749478,-.317272],upDirection:[.0729617,.340294,.937484]},{speed:923281e-9,loop:0,delta_time:.967078,time:0,position:[-.0822389,-3.32222,.145023],direction:[.639143,.724864,-.257038],upDirection:[.0400374,.302399,.95234]},{speed:747858e-9,loop:0,delta_time:.18968,time:0,position:[-.073899,-3.31155,.145799],direction:[.45481,.724306,.518197],upDirection:[-.457636,-.30909,.833686]},{speed:445471e-9,loop:0,delta_time:.260739,time:0,position:[-.0718115,-3.29705,.157324],direction:[-.0670778,.850366,.521899],upDirection:[-.659347,-.430365,.61648]},{speed:317798e-9,loop:0,delta_time:.459455,time:0,position:[-.0633421,-3.26745,.168767],direction:[.534695,.83623,.121742],upDirection:[-.482845,.184096,.856137]},{speed:336629e-9,loop:0,delta_time:.647202,time:0,position:[-.0234504,-3.24438,.164568],direction:[.969507,.163967,-.182127],upDirection:[.233321,-.844882,.481389]},{speed:317798e-9,loop:0,delta_time:.660596,time:0,position:[.0219885,-3.25416,.156189],direction:[.058206,.0307615,-.997831],upDirection:[-.501567,-.863313,-.0558722]},{speed:845574e-10,loop:0,delta_time:.258521,time:0,position:[.0166863,-3.26023,.139555],direction:[-.623287,-.42886,-.653905],upDirection:[-.740661,.0554981,.669583]},{speed:209979e-9,loop:0,delta_time:.178667,time:0,position:[.00700304,-3.26143,.129233],direction:[-.244532,.354837,-.902383],upDirection:[-.944265,.12437,.304787]},{speed:111897e-9,loop:0,delta_time:.500609,time:0,position:[.00351775,-3.22776,.11638],direction:[-.16501,-.246708,-.954938],upDirection:[-.883163,-.394075,.254417]},{speed:997284e-10,loop:0,delta_time:.2509,time:0,position:[-575357e-9,-3.21416,.105418],direction:[.311592,.18004,-.933004],upDirection:[-.840317,-.406171,-.359016]},{speed:.00211643,loop:1,delta_time:5.591,time:2.99974,position:[-.2074915080448,-2.93074541888,.0517582298816],direction:[.744422,-.666556,.0392224],upDirection:[-.153766,-.113973,.981512]}]},getGreetingTexts:function(){var a=.41162265598773956;return[["Inque",4210943,.2189365386962891,-3.51763484954834,a],["CNCD FAIRLIGHT",4223231,.2348936538696289,-3.41763484954834,a],["STILL",8405247,.4248936538696289,-3.31763484954834,a],["TRIAD",4210895,.4848936538696289,-3.40763484954834,a],["NOICE",9449727,.544893653869629,-3.40763484954834,a],["Censor Design",3174655,.4148936538696289,-3.44763484954834,a],["oxyron",3170544,.6048936538696289,-3.28763484954834,a],["ASD",4223231,.6248936538696289,-3.51763484954834,a],["Scoopex",9453823,.32489365386962893,-3.71763484954834,a],["Haujobb",8405247,.7048936538696289,-3.38763484954834,a],["LMAN",4223231,.8048936538696289,-3.32763484954834,a],["Alcatraz",9466111,.4348936538696289,-3.08763484954834,a],["TRSI",6303967,.534893653869629,-3.18763484954834,a],["KNIGHTY",4219135,.1189365386962891,-2.71763484954834,a],["OFFENCE & PROSONIX",9453823,-.1248936538696289,-2.64763484954834,a],["CONSPIRACY/CNS",8405247,.189365386962891,-2.51763484954834,a],["MERCURY",4223231,.1348936538696289,-2.88763484954834,a],["AKRONYME ANALOGIKER",4219135,.3489365386962891,-3.21763484954834,a],["ONSLAUGHT",4210895,.2189365386962891,-3.91763484954834,a],["Booze Design",5259519,.1189365386962891,-3.71763484954834,a],["1001",4227327,.4348936538696289,-3.88763484954834,a],["RAZOR 1911",6312143,.2489365386962891,-3.61763484954834,a],["FARBRAUSCH",4210943,.3489365386962891,-3.81763484954834,a]]},createXSmiley:function(a,b,c,d){var e={paths:["M1422 2879 c-566 -33 -998 -257 -1147 -595 -31 -69 -65 -195 -65 -238 0 -31 -40 -206 -79 -346 -60 -216 -74 -543 -32 -739 53 -249 183 -453 363 -569 158 -101 453 -206 718 -253 104 -19 160 -23 330 -23 224 0 296 10 479 64 293 87 608 303 719 494 260 443 301 936 113 1332 -134 280 -374 541 -647 702 -141 84 -359 156 -503 167 -42 4 -85 7 -96 9 -11 1 -80 -1 -153 -5z ","m1812 2775 c217 -55 420 -173 603 -347 193 -184 340 -413 399 -620 85 -297 49 -631 -104 -962 -73 -159 -122 -225 -245 -326 -342 -280 -765 -387 -1249 -314 -306 46 -667 185 -804 310 -119 108 -198 243 -243 419 -22 81 -24 112 -24 305 0 235 13 333 65 505 15 50 35 135 44 190 43 251 80 353 171 467 134 170 391 307 690 367 87 18 238 35 370 44 78 4 231 -13 327 -38z","M1375 2673 c-246 -20 -487 -88 -646 -183 -132 -78 -243 -203 -288 -326 -12 -30 -32 -119 -46 -197 -13 -78 -38 -190 -55 -249 -44 -152 -60 -253 -67 -408 -13 -306 52 -516 206 -671 66 -66 92 -84 191 -132 513 -245 1061 -262 1470 -44 169 89 323 214 384 311 87 139 163 338 192 509 32 185 9 414 -60 584 -95 231 -307 482 -531 626 -238 152 -455 205 -750 180z ","m1881 2318 c20 -20 14 -45 -28 -115 -23 -36 -37 -69 -33 -72 4 -3 40 -27 79 -53 88 -58 99 -70 85 -96 -20 -38 -41 -34 -123 18 -44 27 -83 50 -88 50 -4 0 -21 -33 -36 -72 -15 -40 -34 -81 -42 -90 -34 -40 -79 -5 -66 49 4 16 22 62 41 102 l34 75 -72 73 c-68 68 -72 74 -61 98 19 41 51 32 112 -30 30 -30 57 -55 60 -55 4 0 25 29 48 65 41 65 64 79 90 53z ","m947 2191 c22 -24 16 -36 -65 -133 l-59 -71 70 -72 c38 -40 70 -76 70 -80 0 -3 -5 -15 -10 -26 -19 -34 -52 -22 -115 41 -33 33 -63 59 -68 57 -5 -1 -23 -29 -40 -62 -26 -48 -37 -61 -59 -63 -59 -7 -53 53 15 162 l24 38 -32 48 c-49 73 -58 107 -35 130 28 28 52 15 84 -46 16 -30 32 -54 37 -54 5 0 36 34 70 75 64 78 84 88 113 56z ","m2410 1743 c82 -28 112 -43 121 -60 11 -20 10 -26 -7 -44 -19 -18 -22 -19 -64 -4 -24 8 -45 14 -47 12 -2 -2 -8 -41 -14 -87 -12 -103 -31 -186 -64 -282 -14 -40 -25 -76 -25 -79 0 -3 17 -11 38 -18 54 -16 112 -60 147 -110 28 -40 30 -49 30 -129 0 -132 -42 -198 -125 -196 -49 2 -89 24 -177 101 l-76 66 -19 -24 c-44 -56 -145 -152 -178 -169 -20 -10 -72 -20 -123 -24 -71 -6 -101 -14 -164 -43 -93 -45 -152 -51 -264 -28 -131 26 -176 53 -313 185 -79 76 -132 120 -152 124 -16 3 -68 13 -116 20 -104 17 -147 36 -192 87 -43 47 -66 91 -100 197 -15 45 -32 82 -37 82 -5 0 -27 -12 -49 -26 -35 -23 -44 -25 -65 -16 -56 26 -22 73 90 127 93 45 168 63 190 45 32 -26 12 -80 -30 -80 -48 -1 -51 -13 -20 -102 64 -187 87 -208 256 -234 56 -8 119 -24 142 -35 22 -12 82 -65 133 -118 100 -104 156 -141 249 -166 101 -26 169 -20 255 21 62 31 90 38 165 44 49 3 99 11 110 17 33 18 148 144 195 212 115 171 210 454 210 627 0 51 -2 54 -24 54 -48 0 -76 58 -38 79 26 16 35 14 152 -26z","M2263 1104 c-3 -9 4 -21 18 -31 44 -30 109 -106 109 -127 0 -26 -18 -46 -40 -46 -8 0 -39 25 -68 55 -56 58 -69 64 -78 40 -6 -15 6 -27 118 -117 67 -54 90 -59 106 -23 50 109 0 210 -126 253 -27 9 -34 9 -39 -4z"],amounts:[100,130,160,190,190,190,220],color:[65793,16777215,65793,16777215,16777215,16777215,65793],emissive:[4144959,4144959,4144959,4144959,4144959,4144959,4144959],center:new THREE.Vector2(300,300)};return EXTRUDER.createMeshes(e,a,b,c,d)},createSmiley:function(a,b,c,d){var e={paths:["m4870,10197c-3,-3 -41,-8 -85,-12c-130,-10 -153,-13 -308,-35c-372,-53 -714,-135 -1017,-245c-504,-184 -881,-383 -1316,-696c-373,-269 -764,-652 -1041,-1021c-462,-616 -760,-1258 -932,-2008c-34,-150 -73,-400 -96,-615c-30,-280 -30,-666 0,-975c39,-411 148,-895 281,-1252c51,-138 178,-436 231,-543c132,-265 363,-632 542,-860c228,-289 536,-605 801,-822c264,-216 737,-519 1000,-641c124,-58 403,-174 536,-223c306,-112 846,-236 1114,-255c41,-3 80,-7 87,-9c59,-20 733,-29 888,-12c39,4 99,10 135,13c212,18 614,91 830,150c141,39 491,159 610,209c156,66 491,232 640,318c351,201 672,449 993,766c418,413 741,859 997,1376c257,519 414,1034 489,1605c11,85 23,175 27,200c12,90 16,773 5,860c-6,47 -13,105 -16,130c-63,569 -179,1015 -397,1519c-95,221 -124,279 -236,476c-245,433 -497,763 -856,1120c-218,218 -297,287 -511,447c-270,202 -502,347 -785,488c-197,99 -269,130 -505,220c-385,146 -669,218 -1110,280c-137,19 -180,24 -315,36c-78,7 -675,17 -680,11z","m3927 8279 c-156 -25 -326 -191 -431 -422 -229 -503 -221 -1229 19 -1712 102 -205 227 -333 369 -377 248 -76 499 136 639 538 217 625 114 1457 -225 1819 -117 126 -238 176 -371 154z M6210 8316 c-274 -59 -499 -445 -566 -969 -25 -196 -16 -522 20 -709 77 -405 248 -704 463 -810 61 -30 76 -33 153 -33 75 0 93 4 153 32 237 112 422 469 483 934 23 175 15 538 -15 694 -31 163 -57 258 -105 376 -114 283 -275 454 -461 488 -32 6 -61 11 -64 10 -3 0 -31 -6 -61 -13z","m1962,5471c-53,-14 -109,-57 -139,-108c-23,-40 -28,-60 -28,-114c0,-55 5,-73 30,-114c26,-42 45,-57 133,-104l103,-56l-6,-40c-13,-103 -17,-513 -5,-633c36,-376 130,-734 280,-1062c302,-664 815,-1207 1436,-1518c205,-103 436,-192 614,-237c711,-180 1469,-99 2110,228c312,159 519,307 763,546c297,292 468,527 648,892c248,502 361,1063 329,1629c-5,96 -10,181 -10,187c0,7 39,33 88,57c129,65 172,121 172,226c0,129 -96,225 -225,224c-57,-1 -75,-9 -400,-171c-187,-94 -359,-185 -381,-201c-48,-35 -94,-119 -94,-172c0,-110 73,-202 182,-228c60,-15 96,-8 189,39c73,36 77,37 82,18c9,-32 1,-374 -11,-489c-63,-610 -340,-1205 -778,-1669c-380,-404 -926,-690 -1489,-783c-123,-20 -175,-23 -430,-23c-258,0 -304,2 -415,23c-292,53 -524,131 -770,259c-379,197 -648,425 -936,794c-67,85 -184,260 -184,274c0,2 -22,41 -49,88c-88,152 -207,469 -261,691c-24,100 -55,311 -71,476c-11,127 -10,363 3,375c4,4 36,-9 72,-28c90,-50 132,-60 195,-46c183,39 245,258 109,385c-18,17 -190,111 -383,208c-362,182 -398,196 -473,177z"],amounts:[700,750,750],color:[16776978,0,0],emissive:[4144959,3092271,3092271],center:new THREE.Vector2(512,512)};return EXTRUDER.createMeshes(e,a,b,c,d)},createAndroid:function(a,b,c,d){var e={paths:["M2343 6241 c-107 -34 -184 -118 -226 -244 -19 -58 -21 -91 -26 -532 l-6 -470 -220 -5 c-210 -5 -222 -6 -269 -30 -54 -27 -126 -102 -159 -164 l-22 -41 0 -1325 0 -1325 1715 0 1715 0 0 1325 0 1325 -21 40 c-34 63 -97 128 -155 160 l-54 30 -220 5 -220 5 -5 480 c-5 463 -6 482 -27 538 -13 32 -36 77 -53 100 -36 49 -116 117 -139 117 -9 0 -34 7 -56 15 -22 8 -69 14 -104 15 -168 1 -295 -90 -353 -253 -21 -60 -22 -80 -28 -537 l-5 -475 -275 0 -275 0 -6 480 c-5 458 -6 483 -26 537 -27 71 -71 137 -120 177 -79 65 -245 89 -360 52z","M743 4382 c-105 -38 -191 -121 -235 -230 l-23 -57 -3 -855 c-2 -828 -2 -857 17 -920 37 -119 109 -203 217 -252 38 -17 68 -22 134 -22 120 0 178 22 255 99 66 64 100 126 115 207 6 30 10 391 10 878 0 888 1 870 -51 972 -29 58 -113 136 -176 166 -76 35 -184 41 -260 14z","M5305 4386 c-102 -32 -190 -112 -239 -215 l-31 -66 0 -885 0 -885 31 -65 c59 -123 147 -195 267 -220 167 -34 326 48 405 208 l37 77 0 880 0 880 -23 57 c-28 68 -87 145 -141 183 -85 59 -214 80 -306 51z","M1430 1905 c-21 -26 3 -231 46 -385 106 -384 368 -711 741 -925 l83 -47 -34 -61 c-19 -34 -83 -145 -141 -247 -114 -200 -124 -232 -71 -238 38 -5 51 11 139 165 170 294 190 328 194 332 2 3 52 -12 111 -32 171 -59 302 -86 474 -99 286 -21 568 15 806 105 l91 35 45 -77 c260 -448 249 -433 291 -429 54 5 45 37 -67 233 -57 99 -120 210 -141 246 l-37 67 117 68 c351 208 613 544 712 917 26 95 53 284 49 338 l-3 44 -1696 3 c-1497 2 -1698 0 -1709 -13z ","m2684 1205 c58 -33 81 -69 81 -127 0 -111 -113 -178 -212 -126 -38 19 -75 84 -75 131 0 33 25 82 51 100 73 51 99 54 155 22z","m4032 1205 c18 -12 42 -40 54 -65 18 -38 20 -49 10 -84 -14 -54 -67 -106 -114 -114 -75 -12 -147 34 -167 106 -19 70 14 136 85 168 47 22 83 19 132 -11z"],amounts:[700,700,700,700,750,750],color:[10799673,10799673,10799673,10799673,16777215,16777215,16777215,16777215,16777215,16777215,16777215,16777215],emissive:[4144959,4144959,4144959,4144959,16777215,16777215,16777215,16777215,16777215,16777215,16777215,16777215],center:new THREE.Vector2(313,313)};return EXTRUDER.createMeshes(e,a,b,c,d)},createRevision:function(a,b,c,d){var e={paths:["M6442 12849 c-2501 -123 -4672 -1741 -5499 -4099 -166 -473 -270 -952 -325 -1505 -20 -201 -17 -906 5 -1110 127 -1172 518 -2184 1196 -3095 134 -181 323 -402 480 -563 l145 -148 -137 -137 -137 -137 347 -297 c327 -279 349 -296 363 -279 8 10 60 74 114 142 55 68 103 128 107 133 4 5 45 -19 91 -52 403 -290 934 -569 1428 -750 487 -178 969 -288 1520 -348 196 -21 778 -30 991 -15 1310 92 2500 561 3499 1380 1255 1029 2050 2511 2214 4126 23 223 39 604 31 738 l-7 117 236 0 236 0 0 98 c0 137 -17 387 -41 587 -115 994 -459 1940 -1004 2765 -234 354 -457 630 -765 944 -399 407 -800 725 -1272 1009 -161 97 -209 121 -218 110 -4 -4 -58 -100 -120 -213 -62 -113 -114 -207 -115 -209 -2 -1 -43 19 -92 47 -959 541 -2146 817 -3271 761z","M7115 12080 c283 -21 594 -68 855 -130 208 -50 420 -113 420 -124 0 -6 -45 -150 -100 -320 -55 -169 -100 -313 -100 -319 0 -7 53 -30 117 -52 145 -49 411 -163 563 -241 63 -32 117 -60 120 -62 4 -1 80 132 171 297 l164 299 37 -19 c61 -31 260 -153 375 -230 485 -324 952 -768 1306 -1242 651 -869 1026 -1928 1064 -2999 l6 -178 -344 -2 -344 -3 -6 -210 c-11 -362 -64 -720 -155 -1053 -19 -69 -33 -127 -31 -128 2 -2 147 -47 323 -100 175 -53 321 -98 323 -100 13 -12 -112 -364 -209 -589 -121 -283 -427 -832 -456 -821 -7 3 -134 86 -283 185 -149 100 -274 181 -278 181 -5 0 -52 -62 -105 -138 -112 -158 -245 -320 -390 -475 l-101 -109 242 -242 243 -243 -124 -116 c-291 -273 -595 -502 -953 -716 -244 -147 -855 -428 -942 -434 -24 -2 -29 8 -134 313 -61 173 -111 316 -113 318 -2 1 -63 -15 -136 -38 -306 -93 -580 -149 -945 -192 -171 -20 -773 -17 -954 5 -79 9 -146 15 -149 12 -2 -2 -25 -152 -51 -334 -25 -181 -49 -332 -52 -335 -3 -3 -72 6 -153 19 -731 124 -1410 390 -2034 798 l-152 99 34 47 c82 113 348 495 352 505 3 7 -53 55 -123 108 -808 608 -1401 1468 -1678 2433 -77 267 -128 532 -162 827 -21 184 -24 765 -5 917 6 52 9 97 7 99 -3 3 -154 22 -336 43 -182 21 -334 41 -337 43 -9 10 27 255 68 456 182 901 583 1721 1186 2430 134 158 452 473 609 604 250 209 515 395 775 546 163 94 458 242 464 232 2 -4 66 -142 140 -307 75 -164 138 -301 141 -303 2 -2 82 27 177 66 525 212 1079 329 1633 345 l80 2 -4 343 -3 342 153 0 c85 0 217 -5 294 -10z","M6470 10454 c-751 -66 -1413 -315 -1990 -750 -819 -617 -1347 -1545 -1466 -2579 -22 -185 -24 -585 -6 -765 115 -1097 670 -2058 1555 -2692 522 -374 1131 -604 1797 -679 172 -20 611 -17 790 5 734 89 1378 359 1955 820 130 104 408 382 518 517 465 572 739 1211 834 1944 22 174 25 671 5 835 -93 756 -358 1393 -816 1966 -108 135 -355 385 -502 508 -558 467 -1205 749 -1954 852 -110 15 -612 27 -720 18z","M5233 9202 l138 -229 182 92 c270 136 530 217 832 261 86 13 185 18 352 19 127 0 233 -2 236 -5 3 -3 -10 -165 -29 -360 -18 -195 -33 -371 -34 -391 l0 -36 68 -7 c315 -32 695 -200 952 -420 36 -31 67 -56 70 -56 3 1 124 129 270 286 l265 286 112 -116 c117 -121 227 -262 315 -402 38 -60 57 -82 68 -78 15 5 395 224 436 251 19 12 23 7 86 -115 85 -163 208 -463 208 -507 0 -6 -115 -46 -255 -90 -209 -64 -255 -82 -250 -94 13 -32 65 -258 79 -342 69 -402 35 -857 -95 -1252 -49 -149 -117 -307 -134 -307 -6 0 -166 74 -355 165 -189 91 -344 164 -345 163 -2 -2 -25 -43 -53 -93 -196 -348 -477 -612 -825 -775 -64 -30 -117 -59 -117 -65 0 -5 62 -170 138 -365 91 -233 135 -358 128 -363 -22 -15 -257 -86 -368 -111 -167 -37 -334 -56 -521 -59 l-166 -2 -5 -35 c-3 -19 -8 -118 -11 -220 -3 -102 -8 -207 -11 -234 l-6 -49 -102 6 c-356 20 -760 128 -1115 298 -465 223 -868 552 -1180 967 -206 274 -396 650 -494 984 -31 104 -33 118 -18 122 9 3 122 33 251 66 129 33 240 62 246 64 7 3 4 37 -12 107 -37 162 -56 340 -57 531 -1 97 0 179 3 181 3 3 176 -6 385 -19 209 -13 385 -22 391 -20 6 2 14 41 17 85 6 82 47 280 72 351 12 34 12 39 -3 45 -9 4 -177 61 -372 127 -195 65 -356 120 -357 122 -6 6 107 267 162 373 100 192 214 356 390 560 l36 41 -123 119 c-68 65 -154 148 -192 184 -59 56 -67 68 -58 85 13 24 223 215 322 291 76 59 300 213 310 213 3 0 67 -103 143 -228z","M6610 7935 c-8 -2 -49 -9 -90 -15 -422 -69 -792 -385 -939 -802 -46 -133 -64 -244 -65 -398 0 -152 10 -219 56 -367 17 -57 29 -105 27 -107 -2 -2 -186 -78 -408 -170 -474 -197 -451 -187 -451 -198 0 -19 120 -250 172 -330 270 -422 700 -750 1176 -898 82 -25 319 -81 323 -76 1 0 33 210 73 466 l71 464 55 -4 c520 -43 987 212 1215 663 180 355 180 759 0 1111 -63 123 -124 206 -230 311 -233 231 -541 357 -865 354 -58 -1 -112 -3 -120 -4z","M6884 7285 c198 -52 369 -223 421 -421 19 -75 19 -220 -1 -297 -48 -187 -201 -350 -382 -408 -215 -68 -440 -13 -598 145 -321 321 -175 860 265 982 65 18 225 17 295 -1z"],amounts:[700,730,760,790,810,840],color:[986895,13684944,986895,13684944,986895,13684944],emissive:[986895,5263440,986895,5263440,986895,5263440],center:new THREE.Vector2(667,669.5)};return EXTRUDER.createMeshes(e,a,b,c,d)}},BOX2="BOX2"in window?BOX2:{},BOX2.PKleinLib=function(){this.defStdReflect=["#define COLOR_ITERS 7","#define REFITER 3","#define DIST_MULTIPLIER 0.763001","#define ITERS 11","#define CSize vec3(0.808001 ,0.808,1.167)","#define Size 1.","#define C vec3(0,0,0)","#define Offset vec3(-4.88759e-007,1.73877e-007,-1.51991e-007)","#define DEoffset 0.","#define MAXI 1.0"],this.defStdReflectX=["#define COLOR_ITERS 7","#define REFITER 3","#define DIST_MULTIPLIER 0.363001","#define ITERS 11","#define CSize vec3(0.808001 ,0.808,1.167)","#define Size 1.","#define C vec3(0,0,0)","#define Offset vec3(-4.88759e-007,1.73877e-007,-1.51991e-007)","#define DEoffset 0.","#define MAXI 1.0"],this.defLowReflect=["#define COLOR_ITERS 7","#define REFITER 2","#define DIST_MULTIPLIER 0.763001","#define ITERS 11","#define CSize vec3(0.808001 ,0.808,1.167)","#define Size 1.","#define C vec3(0,0,0)","#define Offset vec3(-4.88759e-007,1.73877e-007,-1.51991e-007)","#define DEoffset 0.","#define MAXI 1.0"],this.defNoReflect=["#define COLOR_ITERS 7","#define REFITER 1","#define DIST_MULTIPLIER 0.763001","#define ITERS 11","#define CSize vec3(0.808001 ,0.808,1.167)","#define Size 1.","#define C vec3(0,0,0)","#define Offset vec3(-4.88759e-007,1.73877e-007,-1.51991e-007)","#define DEoffset 0.","#define MAXI 1.0"],this.defMengerNo=["#define COLOR_ITERS 5","#define REFITER 1","#define DIST_MULTIPLIER 0.5","#define ITERS 6","#define CSize vec3(0.76,0.84,0.84)","#define Size 0.74766","#define C vec3(-0.81740,-0.46956,-0.67828)","#define Offset vec3(0.02196, 0.02196, -0.24176)","#define DEoffset 0.0","#define MAXI 1.0"],this.defMengerLow=["#define COLOR_ITERS 5","#define REFITER 3","#define DIST_MULTIPLIER 0.5","#define ITERS 6","#define CSize vec3(0.76,0.84,0.84)","#define Size 0.74766","#define C vec3(-0.81740,-0.46956,-0.67828)","#define Offset vec3(0.02196, 0.02196, -0.24176)","#define DEoffset 0.0","#define MAXI 1.0"],this.defAltStd=["#define COLOR_ITERS 7","#define REFITER 3","#define DIST_MULTIPLIER 0.763001","#define ITERS 11","#define CSize vec3(0.808001 ,0.808,1.167)","#define Size 1.","#define C vec3(0,0,0)","#define Offset vec3(-4.88759e-007,1.73877e-007,-1.51991e-007)","#define DEoffset 0.","#define MAXI 0.5"],this.defAltStdLow=["#define COLOR_ITERS 7","#define REFITER 2","#define DIST_MULTIPLIER 0.563001","#define ITERS 11","#define CSize vec3(0.808001 ,0.808,1.167)","#define Size 1.","#define C vec3(0,0,0)","#define Offset vec3(-4.88759e-007,1.73877e-007,-1.51991e-007)","#define DEoffset 0.","#define MAXI 0.5"],this.defLowLoops=["#define COLOR_ITERS 5","#define REFITER 2","#define DIST_MULTIPLIER 0.8","#define ITERS 6","#define CSize vec3(0.908001 ,1.808,1.167)","#define Size 1.0","#define C vec3(0,0,0)","#define Offset vec3(-4.88759e-007,1.73877e-007,-1.51991e-007)","#define DEoffset 0.","#define MAXI 1.0"],this.defLowLoops2=["#define COLOR_ITERS 5","#define REFITER 2","#define DIST_MULTIPLIER 0.7","#define ITERS 6","#define CSize vec3(0.908001 ,1.808,1.167)","#define Size 0.87","#define C vec3(0.02,0.03,0)","#define Offset vec3(0.,0.,0.)","#define DEoffset 0.","#define MAXI 1.0"],this.effects={},this.effects[0]=new BOX2.PKleinConfig(this.defMengerLow,["float d_shape(vec3 p) {","   float y=  0.892;","   float rxy =  sin(length(p.xy)-y);","   return max(rxy,  -(length(p.xy)*p.z-TThickness) / sqrt(dot(p,p)+abs(TThickness)));","}"]),this.effects[1]=new BOX2.PKleinConfig(this.defStdReflect,["float d_shape(vec3 p) {","   float y=  100.992;","   y=  0.992;","   float rxy =  (sin(length(p.xy)-p.z));","   return mix(rxy,  -(length(p.xy)*abs(p.z)-TThickness) / sqrt(dot(p,p)-(TThickness)),.7);","}"]),this.effects[3]=new BOX2.PKleinConfig(this.defStdReflect,["float d_shape(vec3 p) {","   float y=  -81.892;","   float rxy =  sign(y)*sin(length(p.xy)-abs(y));","   return 0.47-max(rxy,  -(length(p.xy)*p.z-TThickness) / sqrt(dot(p,p)+abs(TThickness)));","}"]),this.effects[4]=new BOX2.PKleinConfig(this.defStdReflectX,["float d_shape(vec3 p) {","   float rxy = (length(p.x));","   return max(rxy,  -(length(p.xy)*p.z-TThickness) / sqrt(dot(p,p)+abs(TThickness)));","}"]),this.effects[5]=new BOX2.PKleinConfig(this.defLowReflect,["float d_shape(vec3 p) {","   float y=  10.892;","   float rxy = sign(y)*(length(p.xy)-abs(y)*0.1);","   return max(rxy,abs(length(p.xy)*p.z-TThickness) / sqrt(dot(p,p)+abs(TThickness)));","}"]),this.effects[6]=new BOX2.PKleinConfig(this.defMengerLow,["float d_shape(vec3 p) {","   float y=  -81.892;","   float rxy =  sign(y)*sin(length(p.xy)-abs(y));","   return 0.47-max(rxy,  -(length(p.xy)*p.z-TThickness) / sqrt(dot(p,p)+abs(TThickness)));","}"]),this.effects[7]=new BOX2.PKleinConfig(this.defLowReflect,["float d_shape(vec3 p) {","\tfloat c = cos(45.0*p.y);","\tfloat s = sin(45.0*p.y);","\tmat2  m = mat2(c,-s,s,c);","\tvec3  q = vec3(m*p.xz,p.y);","   float rxy = length(q) - 1.0946;","   return max(min(rxy,-(length(p.xy)*q.x-TThickness) / sqrt(dot(p,p)+abs(TThickness))),p.x*0.7);","}"]),this.effects[8]=new BOX2.PKleinConfig(this.defStdReflectX,["float d_shape(vec3 p) {","\tvec2 t= vec2(0.7,0.2);","\tfloat f= length(vec2(length(p.xz)-t.x,p.y))-t.y;","\tfloat c = cos(PI_HALF/180.*p.x);","\tfloat s = sin(PI_HALF/180.*p.x);","\tvec3  q = vec3( mat2(c,-s,s,c)*p.xz,p.y);","   float rxy =  sin(length(p.xy)-abs(q.z+f));","   return max(rxy, (-(length(p.xy)*.1-TThickness) / sqrt(dot(p,p)+abs(TThickness))));","}"]),this.effects[9]=new BOX2.PKleinConfig(this.defLowReflect,["float d_shape(vec3 p) {","\tvec2 t= vec2(0.7,0.2);","\tfloat f= length(vec2(length(p.xz)-t.x,p.y))-t.y;","\tfloat c = cos(PI_HALF*15.*p.x);","\tfloat s = sin(PI_HALF*15.*p.x);","\tvec3  q = vec3( mat2(c,-s,s,c)*p.xz,p.y);","   return max(-(f*q.x) / sqrt(dot(p,p)), (-q.z-abs(f)));","}"]),this.effects[10]=new BOX2.PKleinConfig(this.defLowReflect,["float d_shape(vec3 p) {","\tvec2 t= vec2(0.7,0.2);","\tfloat f= length(vec2(length(p.xz)-t.x,p.y))-t.y;","\tfloat c = cos(PI_HALF*15.*p.x);","\tfloat s = sin(PI_HALF*15.*p.x);","\tvec3  q = vec3( mat2(c,-s,s,c)*p.xz,p.y);","   return max(f*f*q.x / sqrt(dot(p,p)), ","(q.y)+f*f);","}"]),this.effects[12]=new BOX2.PKleinConfig(this.defStdReflect,["float d_shape(vec3 p) {","\tvec2 t= vec2(0.7,0.2);","\tfloat f= length(vec2(length(p.xz)-t.x,p.y))-t.y;","\tfloat c = cos(PI_HALF*15.*p.x);","\tfloat s = sin(PI_HALF*15.*p.x);","\tvec3  q = vec3( mat2(c,-s,s,c)*p.xz,p.y);","   return max(-(f*q.x) / sqrt(dot(p,p)), q.x*f*f);","}"]),this.effects[13]=new BOX2.PKleinConfig(this.defLowReflect,["float d_shape(vec3 p) {","\tvec2 t= vec2(0.7,0.2);","\tfloat f= length(vec2(length(p.xz)-t.x,p.y))-t.y;","\tfloat c = cos(PI_HALF*15.*p.x);","\tfloat s = sin(PI_HALF*15.*p.x);","\tvec3  q = vec3( mat2(c,-s,s,c)*p.xz,p.y);","   return max(-(f*q.x) / sqrt(dot(p,p)), q.y*f);","}"]),this.effects[14]=new BOX2.PKleinConfig(this.defLowReflect,["float d_shape(vec3 p) {","\tvec2 t= vec2(0.7,0.2);","\tfloat f= length(vec2(length(p.xz)-t.x,p.y))-t.y;","\tfloat c = cos(PI_HALF*15.*p.x);","\tfloat s = sin(PI_HALF*15.*p.x);","\tvec3  q = vec3( mat2(c,-s,s,c)*p.xz,p.y);","   return max(-(f*q.x) / sqrt(dot(p,p)), q.z*f);","}"]),this.effects[15]=new BOX2.PKleinConfig(this.defLowReflect,["float d_shape(vec3 p) {","\tvec2 t= vec2(0.7,0.2);","\tfloat f= length(vec2(length(p.xz)-t.x,p.y))-t.y;","   return length(p.xy)/-dot(p,p)*f;","}"]),this.effects[16]=new BOX2.PKleinConfig(this.defMengerNo,["#define MnIterations 6","#define MnScale 2.71264","#define MnOffset vec3(1.45680,1.90124,0.79012)","#define Bailout 100.","float d_shape(vec3 p) {","\tint n = 0;","\tp = abs(p);","\tif (p.x<p.y){ p.xy = p.yx;}","\tif (p.x<p.p){ p.xz = p.zx;}","\tif (p.y<p.p){ p.yz = p.zy;}","\tif (p.p<1./3.){ p.p -=2.*( p.p-1./3.);}","for (int i= 0; i < MnIterations; i++) {","\t\tp=MnScale* (p-MnOffset)+MnOffset;","\t\tp = abs(p);","\t\tif (p.x<p.y){ p.xy = p.yx;}","\t\tif (p.x< p.p){ p.xz = p.zx;}","\t\tif (p.y<p.p){ p.yz = p.zy;}","\t\tif (p.p<1./3.*MnOffset.p){ p.p -=2.*( p.p-1./3.*MnOffset.p);}","\t\tn++;","\t\tif (!(dot(p,p)<Bailout)) break;","\t}","\treturn float(p.x-MnOffset) * pow(MnScale, float(-n));","}"]),this.effects[17]=new BOX2.PKleinConfig(this.defAltStdLow,["float d_shape(vec3 p) {","\tvec2 t= vec2(0.7,0.2);","\tfloat f= length(vec2(length(p.xz)-t.x,p.y))-t.y;","   return length(p.xy)/-dot(p,p)*f;","}"]),this.effects[18]=new BOX2.PKleinConfig(this.defAltStdLow,["float d_shape(vec3 p) {","\tvec2 t= vec2(0.7,0.2);","\tfloat f= length(vec2(length(p.xz)-t.x,p.y))-t.y;","\tfloat c = cos(PI_HALF*15.*p.x);","\tfloat s = sin(PI_HALF*15.*p.x);","\tvec3  q = vec3( mat2(c,-s,s,c)*p.xz,p.y);","   return max(-(f*q.x) / sqrt(dot(p,p)), f*f);","}"]),this.effects[19]=new BOX2.PKleinConfig(this.defMengerNo,["float d_shape(vec3 p) {","   float y=  10.892;","   float rxy = sign(y)*(length(p.xy)-abs(y)*0.04);","   return max(rxy,abs(length(p.xy)*p.z-TThickness) / sqrt(dot(p,p)+abs(TThickness)));","}"]),this.effects[20]=new BOX2.PKleinConfig(this.defLowReflect,["float d_shape(vec3 p) {","   return max(-abs(p.x), -0.05 / length(p));","}"]),this.effects[33]=new BOX2.PKleinConfig(this.defLowLoops,["#define jIterations 11","#define jThreshold 34.568","#define jC vec4(0.27132,0.45736,-0.27132,1.)","float d_shape(vec3 pos) {","\tvec4 p = vec4(pos, 0.0);","\tvec4 dp = vec4(1.0, 0.0,0.0,0.0);","\tfor (int i = 0; i < jIterations; i++) {","\t\tdp = 2.0* vec4(p.x*dp.x-dot(p.yzw, dp.yzw), p.x*dp.yzw+dp.x*p.yzw+cross(p.yzw, dp.yzw));","\t\tp = vec4(p.x*p.x-dot(p.yzw, p.yzw), vec3(2.0*p.x*p.yzw)) + jC;","\t\tfloat p2 = dot(p,p);","\t\tif (p2 > jThreshold) break;","\t}","\tfloat r = length(p);","\tr=  0.5 * r * log(r) / length(dp);","\treturn abs(pos.z*r);","}"]),this.effects[34]=new BOX2.PKleinConfig(this.defLowLoops2,["#define jIterations 11","#define jThreshold 34.568","#define jC vec4(0.27132,0.45736,-0.27132,1.)","float d_shape(vec3 pos) {","\tvec4 p = vec4(pos, 0.0);","\tvec4 dp = vec4(1.0, 0.0,0.0,0.0);","\tfor (int i = 0; i < jIterations; i++) {","\t\tdp = 2.0* vec4(p.x*dp.x-dot(p.yzw, dp.yzw), p.x*dp.yzw+dp.x*p.yzw+cross(p.yzw, dp.yzw));","\t\tp = vec4(p.x*p.x-dot(p.yzw, p.yzw), vec3(2.0*p.x*p.yzw)) + jC;","\t\tfloat p2 = dot(p,p);","\t\tif (p2 > jThreshold) break;","\t}","\tfloat r = length(p);","\tr=  0.5 * r * log(r) / length(dp);","\treturn r;","}"])},BOX2.PKleinLib.prototype={getEffect:function(a){return this.effects[""+a]}},DEMO="DEMO"in window?DEMO:{},DEMO.MultiTargetEffectComposer=function(a,b){if(this.renderer=a,void 0===b){var c={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1},d=a.getSize();b=new THREE.WebGLRenderTarget(d.width,d.height,c)}this.renderTarget1=b,this.renderTarget2=this.cloneMultiTarget(b),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===THREE.CopyShader&&console.error("DEMO.MultiTargetEffectComposer relies on THREE.CopyShader"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader)},Object.assign(DEMO.MultiTargetEffectComposer.prototype,{swapTarget:function(a){return a.needsSwap=!0,a.renderToScreen=!1,a.clear=!1,a.clearDepth=!1,a},sameTarget:function(a){return a.renderToScreen=!1,a.needsSwap=!1,a.clearDepth=!1,a.clear=!1,a},cloneMultiTarget:function(a){var b=a.clone();if(null!==a.attachments&&a.attachments.length>0){b.attachments=[b.texture];var c=b.texture.clone();b.attachments.push(c)}return b},swapBuffers:function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=a},addPass:function(a){this.passes.push(a);var b=this.renderer.getSize();a.setSize(b.width,b.height)},insertPass:function(a,b){this.passes.splice(b,0,a)},render:function(a){var b,c,d=!1,e=this.passes.length;for(c=0;c<e;c++)if(b=this.passes[c],!1!==b.enabled){if("preProcess"in b&&b.preProcess(this.readBuffer),b.render(this.renderer,this.writeBuffer,this.readBuffer,a,d),b.needsSwap){if(d){var f=this.renderer.context;f.stencilFunc(f.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,a),f.stencilFunc(f.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(b instanceof THREE.MaskPass?d=!0:b instanceof THREE.ClearMaskPass&&(d=!1))}},reset:function(a){if(void 0===a){var b=this.renderer.getSize();a=this.cloneMultiTarget(this.renderTarget1),a.setSize(b.width,b.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=a,this.renderTarget2=this.cloneMultiTarget(a),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(a,b){this.renderTarget1.setSize(a,b),this.renderTarget2.setSize(a,b);for(var c=0;c<this.passes.length;c++)this.passes[c].setSize(a,b)}}),DEMO.NorthlightShader={uniforms:{background:{type:"v3",value:new THREE.Vector3},baseColor:{type:"v3",value:new THREE.Vector3},size:{type:"v2",value:new THREE.Vector2},time:{type:"f",value:0},tNoise:{type:"t",value:null}},vertexShader:["#ifdef GL_ES","precision highp float;","#endif","void main()\t{","  gl_Position = vec4(position, 0.);","}"].join("\n"),fragmentShader:["#ifdef GL_ES","precision highp float;","#endif","uniform vec3 background;","uniform vec3 baseColor;","uniform vec2 size;","uniform float time;","uniform sampler2D tNoise;","#define PI_H 1.570796","#define SCALE PI_H*.001","float noise(in vec3 p)","{","\tvec3 ip = floor(p);","    vec3 f = fract(p);","\tf = f*f*(3.0-2.0*f);","\tvec2 uv = (ip.xy+vec2(37.0,17.0)*ip.z) + f.xy;","\tvec2 rg = texture2D( tNoise, (uv+ 0.5)/256.0, -16.0 ).yx;","\treturn mix(rg.x, rg.y, f.z);","}","float northlight(vec2 d) {","    float s= 17.;","    vec3  p = vec3(d.x*s, d.y*s, SCALE*time );","    float f = 0.;","    f +=       abs(noise(p));","    p =1.3 * p;","    f += 0.75 * abs(noise(p));","    return f*.08954;","}","vec2 distort(vec2 uv, float s) {","    vec2 p= uv/s;","    float f= cos(p.x);","    p.y= -sin(p.y)*p.x;","    p.x= f;","    return p;","}","void main()","{","\t vec2 p = distort(gl_FragCoord.xy, size.x);","    float o =  northlight(p);","    vec3 col = baseColor;","    float a= 1. - 16.*o;","    col += a;","    float alpha = min(1., o*20.);","    col= mix(col, background, min(1., o*4.));","\tfloat h= size.y/2.;","\talpha*= 1.-sin(abs(gl_FragCoord.y-h)/h*PI_H);","    gl_FragColor = vec4(col, alpha);","}"].join("\n")},DEMO.NorthlightPass=function(){THREE.Pass.call(this),void 0===DEMO.NorthlightShader&&console.error("DEMO.NorthlightPass relies on DEMO.NorthlightShader");var a=DEMO.NorthlightShader;this.uniforms=THREE.UniformsUtils.clone(a.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},DEMO.NorthlightPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:DEMO.NorthlightPass,render:function(a,b,c,d,e){this.quad.material=this.material,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}}),DEMO.AttachmentShader={uniforms:{color:{type:"fv",value:[1,1,1]},opacity:{type:"f",value:1},channel:{type:"i",value:1}},vertexShader:["#extension GL_EXT_draw_buffers : require","uniform vec3 color;","uniform float opacity;","uniform int channel;","varying vec2 vUv;","void main() {","    vUv = uv;","    gl_Position = projectionMatrix *","                  modelViewMatrix * vec4(position, 1.0 );","}"].join("\n"),fragmentShader:["#extension GL_EXT_draw_buffers : require","precision highp float;","varying vec2 vUv;","uniform vec3 color;","uniform float opacity;","uniform int channel;","void main(void) {","    gl_FragData[0] = vec4(color, opacity);","    float r= (channel == 1) ? 1. : 0.;","    float g= (channel == 2) ? 1. : 0.;","    if(channel == 3) {r=1.; g=1.;}","    gl_FragData[1] = vec4(r,g,0.,1.);","}"].join("\n"),getUniforms:function(a,b,c){var d=THREE.UniformsUtils.clone(DEMO.AttachmentShader.uniforms);return d.color={type:"fv",value:[(a>>16)/255,(a>>8&255)/255,(255&a)/255]},d.opacity={type:"f",value:b},d.channel={type:"i",value:c},d}},DEMO.GlowShader={uniforms:{tDiffuse:{value:null},tScratchpad:{value:null},uStepWidth:{type:"f",value:.001},uGlowFactor:{type:"f",value:.0141}},vertexShader:["#extension GL_EXT_draw_buffers : require","#extension GL_EXT_frag_depth : enable","precision mediump float;","varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#extension GL_EXT_draw_buffers : require","#extension GL_EXT_frag_depth : enable","precision mediump float;","uniform sampler2D tDiffuse;","uniform sampler2D tScratchpad;","uniform float uStepWidth;","uniform float uGlowFactor;","#define SAMPLE_STEPS 3","#define SAMPLE_SIZE 2*SAMPLE_STEPS+1","varying vec2 vUv;","void main()","{","\tvec4 c= texture2D(tDiffuse, vUv.xy );","\tvec4 d= texture2D(tScratchpad, vUv.xy );","\tfloat result= 0.;","\tfloat maxDist= distance(float(SAMPLE_STEPS),float(SAMPLE_STEPS));","\tfloat startx = vUv.x - float(SAMPLE_STEPS) * uStepWidth;","\tfloat starty = vUv.y - float(SAMPLE_STEPS) * uStepWidth;","\tfor(int i= 0; i< SAMPLE_SIZE; i++) {","\t\tfor(int j= 0; j< SAMPLE_SIZE;j++) {","\t\t\tif (texture2D(tScratchpad, vec2(startx+float(i)*uStepWidth,starty+float(j)*uStepWidth)).r == 1.) {","\t\t\t\tfloat w= distance(abs(float(i-SAMPLE_STEPS)), abs(float(j-SAMPLE_STEPS)));","\t\t\t\tw=1.-((maxDist/w));","\t\t\t\tresult+= w;","\t\t\t}","\t\t}","\t}","\tresult*= uGlowFactor;","\tresult= abs(result);","\tgl_FragData[0] = vec4(min(1., c.x+result), min(1., c.y+result), min(1., c.z+result), 1.);","\tgl_FragData[1] = d;","}"].join("\n")},DEMO.GlowPass=function(){THREE.Pass.call(this),void 0===DEMO.GlowShader&&console.error("DEMO.GlowPass relies on DEMO.GlowShader");var a=DEMO.GlowShader;this.uniforms=THREE.UniformsUtils.clone(a.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},DEMO.GlowPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:DEMO.GlowPass,render:function(a,b,c,d,e){this.uniforms.tDiffuse.value=c.texture,this.uniforms.tScratchpad.value=c.attachments[1],this.quad.material=this.material,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)},reconfigure:function(a,b){this.uniforms.uStepWidth.value=a,this.uniforms.uGlowFactor.value=b}}),DEMO.RaysShader={uniforms:{tDiffuse:{value:null},tScratchpad:{value:null},exposure:{value:1},decay:{value:.1},density:{value:.05},weight:{value:.8},lightPositionOnScreen:{type:"v2",value:new THREE.Vector2(700,100)}},vertexShader:["precision mediump float;","varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform sampler2D tDiffuse;","uniform sampler2D tScratchpad;","uniform float exposure;","uniform float decay;","uniform float density;","uniform float weight;","uniform vec2 lightPositionOnScreen;","const int NUM_SAMPLES = 100;","varying vec2 vUv;","void main()","{","vec2 xy = vUv;","vec2 deltaXy = vec2( xy - lightPositionOnScreen.xy );","vec4 c= texture2D(tDiffuse, xy );","deltaXy *= 1. /  (float(NUM_SAMPLES) * density);","float lumDecay = 1.;","for(int i=0; i < NUM_SAMPLES ; i++) {","\t xy -= deltaXy;","\t float t = texture2D(tScratchpad, xy ).y;","\t if (t == 1.) {","\t \tc += vec4(1.,1.,1.,0.) * (lumDecay * weight);","\t }","\t lumDecay *= decay;","}","gl_FragColor = c*exposure;","}"].join("\n")},DEMO.RaysPass=function(a,b,c,d,e){THREE.Pass.call(this),void 0===DEMO.RaysShader&&console.error("DEMO.RaysPass relies on DEMO.RaysShader");var f=DEMO.RaysShader;this.uniforms=THREE.UniformsUtils.clone(f.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}),void 0!==a&&(this.uniforms.lightPositionOnScreen.value=a),void 0!==b&&(this.uniforms.weight.value=b),void 0!==c&&(this.uniforms.density.value=c),void 0!==d&&(this.uniforms.decay.value=d),void 0!==e&&(this.uniforms.exposure.value=e),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},DEMO.RaysPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:DEMO.RaysPass,render:function(a,b,c,d,e){this.uniforms.tDiffuse.value=c.texture,this.uniforms.tScratchpad.value=c.attachments[1],this.quad.material=this.material,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}}),DEMO.BokehShader={uniforms:{tDiffuse:{value:null},tSampler:{value:null},tDepth:{value:null},size:{type:"v2",value:null}},vertexShader:["#extension GL_EXT_draw_buffers : require","precision mediump float;","varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#extension GL_EXT_draw_buffers : require","precision mediump float;","uniform sampler2D tDiffuse;","uniform sampler2D tSampler;","uniform sampler2D tDepth;","uniform vec2 size;","varying vec2 vUv;","#define GOLDEN_ANGLE 2.39996323","#define ITERATIONS 10","#define D 0.04","mat2 rot = mat2(cos(GOLDEN_ANGLE), sin(GOLDEN_ANGLE), -sin(GOLDEN_ANGLE), cos(GOLDEN_ANGLE));","vec3 Bokeh(sampler2D tex, vec2 uv, float radius, float amount)","{","\tvec3 acc = vec3(0.0);","\tvec3 div = vec3(0.0);","    vec2 pixel = 1.0 / size.xy;","    float r = 1.0;","    vec2 vangle = vec2(0.0,radius);","    amount += radius*100.0;","\tfor (int j = 0; j < ITERATIONS; j++)","    {  ","       r += 1. / r;","\t    vangle = rot * vangle;","       #ifdef USE_MIPMAP","\t\tvec3 col = texture2D(tex, uv + pixel * (r-1.) * vangle, radius).xyz;","       #else","       vec3 col = texture2D(tex, uv + pixel * (r-1.) * vangle).xyz;","       #endif","\t\tvec3 bokeh = pow(col, vec3(9.0)) * amount+.4;","\t\tacc += col * bokeh;","\t\tdiv += bokeh;","\t}","\treturn acc / div;","}","void main()","{","\tfloat depth =texture2D(tDepth,vUv).r;","\tfloat d0 = \ttexture2D(tSampler,vec2(.5,.5)).r;","\tdepth = ((d0 == 0.) || (depth == 0.)) ? 1.0 : abs(.5* log(depth/d0))*100.;","\tgl_FragData[0] = vec4(Bokeh(tDiffuse, vUv, depth, 20.), 1.0);","}"].join("\n")},DEMO.DofPass=function(){THREE.Pass.call(this),void 0===DEMO.BokehShader&&console.error("DEMO.DofPass relies on DEMO.BokehShader");var a=DEMO.BokehShader;this.uniforms=THREE.UniformsUtils.clone(a.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad),this.samplerTarget=this._createDofSamplerRenderTarget(1,1),this.uniforms.tSampler.value=this.samplerTarget.texture},DEMO.DofPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:DEMO.DofPass,render:function(a,b,c,d,e){this.uniforms.tDiffuse.value=c.texture,this.uniforms.tDepth.value=c.attachments[1],this.uniforms.size.value=new THREE.Vector2(c.width,c.height),this.quad.material=this.material,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)},getSamplerTarget:function(){return this.samplerTarget},_createDofSamplerRenderTarget:function(a,b){var c=new THREE.WebGLRenderTarget(a,b),d=c.texture;return d.name="dof sampler",d.format=THREE.RGBAFormat,d.minFilter=THREE.LinearFilter,d.magFilter=THREE.LinearFilter,d.type=THREE.FloatType,d.generateMipmaps=!1,d.wrapS=d.wrapT=THREE.RepeatWrapping,d.repeat.set(1,1),c.stencilBuffer=!1,c.depthBuffer=!1,c}}),DEMO.DofSamplerShader={uniforms:{tDepth:{value:null}},vertexShader:["precision highp float;","varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D tDepth;","varying vec2 vUv;","#define STEPS 10","#define D 0.01","void main()","{","\tfloat s= .5 - float(STEPS)*D*.5;","\tfloat d0= 0.;","\tfloat y= s;","\tfor (int i= 0; i<STEPS; i++) {","\t\tfloat x= s;","\t\tfor (int j= 0; j<STEPS; j++) {","\t\t\td0+= texture2D(tDepth,vec2(x,y)).r;","\t\t\tx+= D;","\t\t}","\t\ty+= D;","\t}","\td0= d0/float(STEPS*STEPS);","\tgl_FragColor = vec4(d0,d0,d0,d0);","}"].join("\n")},DEMO.DofSamplerPass=function(){THREE.Pass.call(this),void 0===DEMO.DofSamplerShader&&console.error("DEMO.DofSamplerPass relies on DEMO.DofSamplerShader");var a=DEMO.DofSamplerShader;this.uniforms=THREE.UniformsUtils.clone(a.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader}),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},DEMO.DofSamplerPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:DEMO.DofSamplerPass,render:function(a,b,c,d,e){this.uniforms.tDepth.value=c.attachments[1],this.quad.material=this.material,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}}),DEMO.OverlaySceneHolder=function(a,b){this._scene=new THREE.Scene;var c=new THREE.AmbientLight(3092271);this._scene.add(c);var d=new THREE.DirectionalLight(4210752,1.4);d.position=new THREE.Vector3(0,-1,0),this._scene.add(d),this._camera=new THREE.PerspectiveCamera(70,a/b,1,3e3),this._camera.position.set(0,5.5,17)},DEMO.OverlaySceneHolder.prototype={resetScreenSize:function(a,b){},getRenderPass:function(){return new THREE.RenderPass(this._scene,this._camera)},getCamera:function(){return this._camera},getScene:function(){return this._scene},setAllInvisible:function(){for(var a=this._scene.children,b=0;b<a.length;b++){var c=a[b];"intensity"in c||(c.visible=!1)}}},DEMO.FilmShader={uniforms:{tDiffuse:{value:null},time:{value:0},nIntensity:{value:.5},sIntensity:{value:.05},sCount:{value:4096},grayscale:{value:1},fadeOut:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform float fadeOut;","uniform sampler2D tDiffuse;","varying vec2 vUv;","float rand(vec2 co){","    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","\tfloat dx = rand( vUv + time );","\tvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );","\tvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","\tcResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","\tcResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","\tif( grayscale ) {","\t\tcResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","\t}","\tcResult = mix(cResult, vec3(0.,0.,0.), fadeOut);","\tgl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},DEMO.FilmPass=function(a,b,c,d){THREE.Pass.call(this),void 0===DEMO.FilmShader&&console.error("DEMO.FilmPass relies on DEMO.FilmShader");var e=DEMO.FilmShader;this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),void 0!==d&&(this.uniforms.grayscale.value=d),void 0!==a&&(this.uniforms.nIntensity.value=a),void 0!==b&&(this.uniforms.sIntensity.value=b),void 0!==c&&(this.uniforms.sCount.value=c),this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new THREE.Scene,this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)},DEMO.FilmPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:DEMO.FilmPass,render:function(a,b,c,d,e){this.uniforms.tDiffuse.value=c.texture,this.uniforms.time.value+=d,this.quad.material=this.material,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}}),DEMO="DEMO"in window?DEMO:{},DEMO.Animation=function(a,b,c,d){this._config=void 0!==a?a:[],this._sustain=void 0!==b?b:0,this._attack=void 0!==c?c:0,this._release=void 0!==d?d:0,this._startFrameCount=-1},DEMO.Animation.prototype={setStarted:function(a){this._startFrameCount=a},attack:function(a,b){},sustain:function(a,b){},release:function(a,b){},play:function(a,b){var c=a-this._startFrameCount;return c<=this._attack&&this.attack(0==this._attack?1:c/this._attack,b,this._config),(0==this._sustain&&c==this._attack||c<=this._attack+this._sustain&&(c>this._attack||0==this._attack))&&this.sustain(b,this._config),c>=this._attack+this._sustain&&this.release(0==this._release?0:1-(c-this._attack-this._sustain)/this._release,b,this._config),c<this._attack+this._sustain+this._release}},DEMO.IAccessor=function(){},DEMO.IAccessor.prototype={update:function(a,b,c,d){}},DEMO.Sequence=function(a,b,c,d,e,f,g,h){this._name=a,this._accessor=b,this._startFrame=c,this._endFrame=d,this._length=this._endFrame-this._startFrame,this._effectKey=e,this._useHackedPath=f,this._animations=void 0!==g?g:null,this._faderCfg=void 0!==h?h:null,this._currentOffset=0},DEMO.Sequence.prototype={getDbgInfo:function(){return"["+this._name+"] "+(this._startFrame+this._currentOffset)},getCurrentFramePosition:function(){return this._startFrame+this._currentOffset},init:function(){this._currentOffset=0},hasMoreFrames:function(){return this._startFrame+this._currentOffset<=this._endFrame},setupNextFrame:function(a){var b=this._startFrame+this._currentOffset;if(this._accessor.update(a,this._effectKey,b,this._useHackedPath),null!=this._faderCfg){var c=this._faderCfg[0],d=this._faderCfg[1],e=this._faderCfg[2],f=0;d>0&&this._currentOffset<d&&(f=1-this._currentOffset/d);var g=this._length-e;e>0&&g<this._currentOffset&&(f=(this._currentOffset-g)/e),c(f)}return this._currentOffset++,null==this._animations?null:this._animations[""+b]}},DEMO.AnimationPlayer=function(a){this._fps=60,this._msPerFrame=1e3/this._fps,this._playList=a,this.restart(0),this._activeAnimations=new Array,this._fpcOverflow=0},DEMO.AnimationPlayer.prototype={getDbgInfo:function(){return this._playList[this._currentIdx].getDbgInfo()},setupAnimationFrame:function(a){var b=!1,c=this._fps/a;this._fpcOverflow+=c,this._msPerFrame=1e3/a;for(var d=Math.floor(this._fpcOverflow),e=0;e<d&&!b;e++)this._timePlayed+=this._msPerFrame,b=this.playOneFrame(this._timePlayed),this._fpcOverflow--,this._frameCount++;return b},restart:function(a){this._timePlayed=a-this._msPerFrame,this._currentIdx=-1,this._frameCount=0},_handleActiveAnimations:function(a){for(var b=new Array,c=0;c<this._activeAnimations.length;c++){var d=this._activeAnimations[c];d.play(this._frameCount,a)&&b.push(d)}this._activeAnimations=b},playOneFrame:function(a){var b;if(this._currentIdx<0||!this._playList[this._currentIdx].hasMoreFrames()){if(++this._currentIdx==this._playList.length)return!0;b=this._playList[this._currentIdx],b.init()}else b=this._playList[this._currentIdx];var c=b.setupNextFrame(a);return null!=c&&(c.setStarted(this._frameCount),this._activeAnimations.push(c)),this._handleActiveAnimations(a),!1}},DEMO.Greets=function(a){this.materials=[],this.group=new THREE.Group,UTIL.getMeshTexter("./res/Vertigo 2 BRK_Normal_W.json",function(b){for(var c=DATA.getGreetingTexts(),d=0;d<c.length;d++){var e=c[d];this.group.add(this._createVerticalText(b,e[0],e[1],new THREE.Vector3(e[2],e[3],e[4])))}a.add(this.group)}.bind(this))},DEMO.Greets.prototype={_createGlowMeterial:function(a){return new THREE.ShaderMaterial({name:"1st pass glow+rays shading",uniforms:DEMO.AttachmentShader.getUniforms(a,.3,3),vertexShader:DEMO.AttachmentShader.vertexShader,fragmentShader:DEMO.AttachmentShader.fragmentShader})},_createVerticalText:function(a,b,c,d){var e=this._createGlowMeterial(c);return e.baseColor=c,this.materials.push(e),UTIL.createText(a,e,b,15e-5,new THREE.Vector3(-90,0,90),d)},_getGlitch:function(a,b){var c=5e3*Math.random();return b-=Math.floor(b/c)*c,b/=c,b=b>.95?b:.005,Math.sin(a*b)*Math.random()*.4},animate:function(a){this.group.visible=!0;for(var b=0;b<this.materials.length;b++){var c=this.materials[b],d=new THREE.Color(c.baseColor),e=this._getGlitch(b,a);d.r-=e,d.g-=e,d.b-=e,c.uniforms.color.value=d}}},DEMO.Background=function(a,b){this.scene=a,this.renderPass=new DEMO.NorthlightPass,this.renderPass.target=this._createBackgroundRenderTarget(2048,128),this.renderPass.uniforms.tNoise.value=BOX2.getGlobalNoiseTexture(),this.renderPass.uniforms.size.value=new THREE.Vector2(600,128),this.renderPass.uniforms.background.value=b,this.setColor(new THREE.Vector3(40/255,140/255,1));var c=new THREE.MeshPhongMaterial({map:this.renderPass.target.texture,side:THREE.DoubleSide,transparent:!0,opacity:1,shading:THREE.SmoothShading,shininess:10,specular:10461183,wireframe:!1}),d=3,e=new THREE.CylinderGeometry(9.7,9.7,d,24,24,!0);this.mesh=new THREE.Mesh(e,c),this.mesh.frustumCulled=!1,this.mesh.rotation.x=Math.PI/2,GEOMETRY.moveTransformsToGeometry(this.mesh),this.mesh.position.x-=-.08,this.mesh.position.y+=-3.3,this.mesh.position.z=d/2-d/10,GEOMETRY.moveTransformsToGeometry(this.mesh),a.add(this.mesh)},DEMO.Background.prototype={setColor:function(a){this.renderPass.uniforms.baseColor.value=a},animate:function(a,b){this.mesh.visible=!0,this.renderPass.uniforms.time.value=b/3,this.renderPass.render(a,this.renderPass.target)},_createBackgroundRenderTarget:function(a,b){var c=new THREE.WebGLRenderTarget(a,b),d=c.texture;return d.name="background texture",d.format=THREE.RGBAFormat,d.minFilter=THREE.LinearFilter,d.magFilter=THREE.LinearFilter,d.type=THREE.FloatType,d.generateMipmaps=!1,d.wrapS=d.wrapT=THREE.RepeatWrapping,d.repeat.set(1,1),c.stencilBuffer=!1,c.depthBuffer=!1,c}},DEMO.Confetti=function(a,b){this.scene=a,this.renderer=b;var c=this.renderer.domElement.clientWidth;this.fadeIn=1e3,this.base=.02,this.height=.8;for(var d=new THREE.Geometry,e=new THREE.Vector3(1,231/255,132/255),f=0;f<2e4;f++){var g=new THREE.Vector3(this._getRandomX(),this._getRandomY(),THREE.Math.randFloatSpread(this.height)+this.height/2+this.base);g.fadeIn=Math.random()*this.fadeIn,g.textTimeStamp=-1,g.textPos=new THREE.Vector3,g.vector=new THREE.Vector4;var h=75*Math.random()/255;d.colors.push(new THREE.Color(e.x,e.y+h,e.z+h)),d.vertices.push(g)}this.confettiGeometry=d,this.material=new THREE.PointsMaterial({vertexColors:THREE.VertexColors,transparent:!0,opacity:.5,size:this.calcParticleSize(c),sizeAttenuation:!1}),this.particleSystem=new THREE.Points(d,this.material),a.add(this.particleSystem),this.canvasWidth=720,this.canvasHeight=150;var i=document.createElement("canvas");i.width=this.canvasWidth,i.height=this.canvasHeight,this.context=i.getContext("2d")},DEMO.Confetti.prototype={calcParticleSize:function(a){return.5+a/640},animate:function(a){var b=this.renderer.domElement.clientWidth;this.material.size=this.calcParticleSize(b),this.particleSystem.visible=!0;for(var c=.001,d=.005,e=d/2,f=.001,g=f/2,h=0;h<this.confettiGeometry.vertices.length;h++){var i=this.confettiGeometry.vertices[h],j=i.z-c;if(i.textTimeStamp>=0){var k=a-i.textTimeStamp;if(k<i.textDelayMs){Math.min(this.fadeIn,k)>=i.fadeIn&&i.set(i.textPos.x,i.textPos.y,i.textPos.z);var l=Math.random()*f-g;i.x+=l;continue}var m=i.vector;if(m.set(m.x*m.w,m.y*m.w,m.z*m.w,m.w),j<this.base){j=this.height,i.textTimeStamp=-1,i.x=this._getRandomX(),i.y=this._getRandomY();continue}i.set(i.x+m.x,i.y+m.y,j+m.z)}else{var n=Math.random()*d-e,o=Math.random()*d-e;j<this.base&&(j=this.height),i.set(i.x+n,i.y+o,j)}}this.confettiGeometry.verticesNeedUpdate=!0,this._animateColors()},triggerText:function(a,b,c,d,e,f){for(var g=new THREE.Euler(THREE.Math.degToRad(f.x),THREE.Math.degToRad(f.y),THREE.Math.degToRad(f.z),"XYZ"),h=this._createStencil(c),i=4*this.canvasWidth,j=this.confettiGeometry.vertices.length,k=2e3,l=0,m=0;m<j&&l<k;m++){var n=this.confettiGeometry.vertices[m];if(!(n.textTimeStamp>=0)){for(var o,p,q=1,r=!1,s=0;s<q;s++)if(o=Math.floor(Math.random()*this.canvasWidth),p=Math.floor(Math.random()*this.canvasHeight),255!=h[4*o+p*i]){r=!0;break}if(r){l++;var t=new THREE.Vector3(o*d,0,(this.canvasHeight-p)*d);t.applyEuler(g),n.textPos.set(t.x+e.x,t.y+e.y,t.z+e.z);var u=.04*Math.random();n.vector.set(u*(Math.random()-.5),u*(Math.random()-.5),u*(Math.random()-.5),.96),n.textTimeStamp=a,n.textDelayMs=b}}}this.confettiGeometry.verticesNeedUpdate=!0},triggerPointExplosion:function(a,b,c){for(var d=1e3,e=this.confettiGeometry.vertices.length,f=Math.floor(e/d),g=0;g<d;g++)for(var h=0;h<f;h++){var i=this.confettiGeometry.vertices[f*g+h];if(!(i.textTimeStamp>=0)){i.textPos.set(c.x,c.y,c.z);var j=.04*Math.random();i.vector.set(j*(Math.random()-.5),j*(Math.random()-.5),j*(Math.random()-.5),.96),i.textTimeStamp=a,i.textDelayMs=b;break}}this.confettiGeometry.verticesNeedUpdate=!0},_animateColors:function(){for(var a=.6,b=1,c=0;c<this.confettiGeometry.colors.length;c++){var d=this.confettiGeometry.colors[c],e=d.b+Math.random()*a;d.b=1<e?e-b:e}this.confettiGeometry.colorsNeedUpdate=!0},_createStencil:function(a){return this.context.fillStyle="white",this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.context.fill(),this.context.font="bold 130px 'Mountains of Christmas'",this.context.fillStyle="black",this.context.fillText(a,10,120),this.context.getImageData(0,0,this.canvasWidth,this.canvasHeight).data},_getRandomX:function(){return THREE.Math.randFloatSpread(2)+.1189365386962891},_getRandomY:function(){return THREE.Math.randFloatSpread(2)+-3.71763484954834}},DEMO.BannerText=function(a){this.scene=a,this.startPos=null,this.textGeo=null,this.txtGroup=this._createBanner(),this.scene.add(this.txtGroup)},DEMO.BannerText.prototype={isReady:function(){return this.txtGroup.children.length>0},_createBanner:function(){var a=new THREE.Group;return a.scale.x=a.scale.y=a.scale.z=.004,a.rotation.x=0,a.rotation.y=-Math.PI/180*10,a.rotation.z=0,UTIL.getMeshTexter("./res/report_1942.json",function(b){this.textGeo=b.create("269life"),GEOMETRY.backupOriginalVertices(this.textGeo);var c=new THREE.ShaderMaterial({name:"1st pass glow+rays shading",uniforms:DEMO.AttachmentShader.getUniforms(255,.3,3),vertexShader:DEMO.AttachmentShader.vertexShader,fragmentShader:DEMO.AttachmentShader.fragmentShader}),d=-.5*(this.textGeo.boundingBox.max.x-this.textGeo.boundingBox.min.x),e=new THREE.Mesh(this.textGeo,c);e.position.x=d,e.position.y=0,e.position.z=0,e.rotation.x=0,e.rotation.y=2*Math.PI,a.add(e)}.bind(this),!0),a},_updateTextGeometry:function(a){var b=(new THREE.Vector3,3e3*Math.random());a-=Math.floor(a/b)*b,a/=b,a=a>.95?a:.005;for(var c=(this.textGeo.originalBoundingBox.x,0),d=this.textGeo.originalVertices.length;c<d;c++){var e=this.textGeo.originalVertices[c],f=Math.sin(e.y*a)*Math.random();this.textGeo.vertices[c].set(e.x+70*f,e.y,e.z)}this.textGeo.computeVertexNormals(),this.textGeo.verticesNeedUpdate=!0},animate:function(a){this.txtGroup.visible=!0;var b=Math.sin(1e-5*a),c=new THREE.Vector3(-.07963,.099261,-1.3678434);c.y=c.y+.02*Math.sin(4e-5*a),c.z=c.z-.44*b,null==this.startPos&&(this.startPos=[c.y,c.z]),a=a<=0?1:a,null!=this.textGeo&&(this._updateTextPosition(c),this._updateTextGeometry(a))},_updateTextPosition:function(a){var b=-.2,c=6,d=13;if(null!=this.startPos){var e=a.y-this.startPos[0],f=a.z-this.startPos[1],g=Math.sqrt(f*f+e*e),h=[.3157312840105159,.44],i=(g-h[0])/(h[1]-h[0])*.5;d+=(13.4-d)*i,b+=(1-b)*i}this.txtGroup.position.x=b,this.txtGroup.position.y=c,this.txtGroup.position.z=d}},DEMO.ExtrudedSvgObject=function(a,b,c,d,e,f){this.scene=a,e=new THREE.Vector3(THREE.Math.degToRad(e.x),THREE.Math.degToRad(e.y),THREE.Math.degToRad(e.z)),this.meshes=b(c,d,e,f);for(var g=0;g<this.meshes.length;g++){var h=this.meshes[g];a.add(h)}},DEMO.ExtrudedSvgObject.prototype={animate:function(a){for(var b=0;b<this.meshes.length;b++)this.meshes[b].visible=!0}},DEMO.KeyFrameHolder=function(){this.currentKeyFrame=-1,this.frames=BOX2.splinedKeyFrames(DATA.KeyFrameConfig,300)},DEMO.KeyFrameHolder.prototype={getKeyFrame:function(a){return this.frames[a]},getKeyFrames:function(){return this.frames},getCurrentKeyFrameIdx:function(){return this.currentKeyFrame},getCurrentKeyFrame:function(){return this.getKeyFrame(this.currentKeyFrame)},keyFrameBack:function(){return this.currentKeyFrame=0==this.currentKeyFrame?this.frames.length-1:(this.currentKeyFrame-1)%this.frames.length,this.getCurrentKeyFrame()},keyFrameForward:function(){return this.currentKeyFrame=(this.currentKeyFrame+1)%this.frames.length,this.getCurrentKeyFrame()}},DEMO.DemoMode={ANIMATION:0,RANDOM:1},Main=function(a){this.initInProgress=!0,this.debug=!0,this.debugCameraPath=!1,this.dofPass=new DEMO.DofPass,this.dofSamplerPass=new DEMO.DofSamplerPass,this.FOV_X=91.3085,this.FOV_Y=75,this.backgroundColor=new THREE.Vector3(.07,.06,.16),this.keyFrameHolder=new DEMO.KeyFrameHolder,this.mode=DEMO.DemoMode.ANIMATION,this.canvasId=a,this.canvas=null,this.timeOffset=0,this.filmPass=new DEMO.FilmPass(0,1.4,500,!1),this.intensity=0,this.beatDetector=new UTIL.SoundDetector(155,1,!1,50,32,1,6),this.kleinianSceneHolder=this.renderer=this.composer=this.target=this.bannerText=null,this.soundVisualsEnabled=!1,this.musicIsReady=!1;var b=function(){var a=function(b){a.base.call(this,b)};return extend(DEMO.Animation,a,{sustain:function(a,b){this.confetti.triggerText(a,b[0],b[1],b[2],b[3],b[4])}.bind(this)}),a}.bind(this)(),c=function(){var a=function(b){a.base.call(this,b)};return extend(DEMO.Animation,a,{sustain:function(a,b){this.confetti.triggerPointExplosion(a,b[0],b[1])}.bind(this)}),a}.bind(this)(),d=function(){var a=function(b,c,d,e){a.base.call(this,[b],e,c,d)};return extend(DEMO.Animation,a,{attack:function(a,b,c){music.setVolume(1-a)}.bind(this),sustain:function(b,c){a.startTrack=c[0]}.bind(this),release:function(b,c,d){null!=a.startTrack&&(music.playTrack(a.startTrack),a.startTrack=null),music.setVolume(1-b)}.bind(this)}),a}.bind(this)(),e=function(){var a=function(b,c,d,e,f,g){a.base.call(this,[b,c,d],f,e,g)};return extend(DEMO.Animation,a,{attack:function(b,c,d){null==a.started&&(this.scrollTexts.configureTextPage(c,d[0],d[1],d[2],0),a.started=!0),this.scrollTexts.animate(c,b)}.bind(this),sustain:function(a,b){this.scrollTexts.animate(a,1)}.bind(this),release:function(b,c,d){this.scrollTexts.animate(c,b),a.started=null}.bind(this)}),a}.bind(this)(),f=function(){var a=function(){a.base.call(this)};return extend(DEMO.IAccessor,a,{update:function(a,b,c,d){this.doUpdateKleinianScene(a,b,c,d),this.glowPass.reconfigure(.0017,.031),this.bannerText.animate(a)}.bind(this)}),a}.bind(this)(),g=function(){var a=function(){a.base.call(this)};return extend(DEMO.IAccessor,a,{update:function(a,b,c,d){this.doUpdateKleinianScene(a,b,c,d),this.glowPass.reconfigure(.0017,.031)}.bind(this)}),a}.bind(this)();this.plainAccessor=new f,this.plainNbAccessor=new g;var h=function(){var a=function(){a.base.call(this)};return extend(DEMO.IAccessor,a,{update:function(a,b,c,d){this.doUpdateKleinianScene(a,b,c,d),this.background.setColor(new THREE.Vector3(40/255,140/255,1)),this.background.animate(this.renderer,a),this.android.animate(a),this.glowPass.reconfigure(.0017,.031),this.bannerText.animate(a)}.bind(this)}),a}.bind(this)(),i=function(){var a=function(){a.base.call(this)};return extend(DEMO.IAccessor,a,{update:function(a,b,c,d){this.doUpdateKleinianScene(a,b,c,d),this.background.setColor(new THREE.Vector3(40/255,140/255,1)),this.background.animate(this.renderer,a),this.android.animate(a),this.glowPass.reconfigure(.0017,.031)}.bind(this)}),a}.bind(this)();this.introAccessor=new h,this.introNbAccessor=new i;var j=function(){var a=function(){a.base.call(this)};return extend(DEMO.IAccessor,a,{update:function(a,b,c,d){this.doUpdateKleinianScene(a,b,c,d),this.background.setColor(new THREE.Vector3(140/255,40/255,1)),this.background.animate(this.renderer,a),this.greets.animate(a),this.confetti.animate(a),this.xsmiley.animate(a),this.revLogo.animate(a),this.glowPass.reconfigure(.001,.0141)}.bind(this)}),a}.bind(this)();this.accessor=new j,this.player=new DEMO.AnimationPlayer([new DEMO.Sequence("glass",this.introNbAccessor,9300,9600,"20",!0,{9331:new e(0,6.2,2.5,60,240,60),9300:new d(0)},[this.setFadeOut.bind(this),60,20]),new DEMO.Sequence("skull mix1",this.introNbAccessor,250,2360,"4",!0,null,[this.setFadeOut.bind(this),20,10]),new DEMO.Sequence("skull mix2 rainbow",this.introNbAccessor,10551,13e3,"4",!0,{10551:new e(1,8.4,1.5,60,300,60),12275:new e(2,7.4,5.5,60,300,60)},[this.setFadeOut.bind(this),10,10]),new DEMO.Sequence("skull slits2",this.introNbAccessor,12900,13550,"7",!0,null,[this.setFadeOut.bind(this),10,10]),new DEMO.Sequence("icepalace1",this.plainAccessor,2200,3560,"8",!1,{2400:new e(3,8.3,3.5,60,300,60)},[this.setFadeOut.bind(this),20,0]),new DEMO.Sequence("icepalace2 colors",this.plainAccessor,10200,11040,"8",!1,null,[this.setFadeOut.bind(this),0,0]),new DEMO.Sequence("emeralds1",this.plainAccessor,9800,11e3,"3",!1,null,[this.setFadeOut.bind(this),0,0]),new DEMO.Sequence("emeralds xmas",this.plainAccessor,5900,6300,"3",!1,null,[this.setFadeOut.bind(this),10,20]),new DEMO.Sequence("crystals",this.introAccessor,5700,6300,"1",!1,null,[this.setFadeOut.bind(this),10,20]),new DEMO.Sequence("cylinders1",this.introAccessor,0,1220,"0",!1,null,[this.setFadeOut.bind(this),20,10]),new DEMO.Sequence("cylinders2",this.introAccessor,8080,9300,"0",!0,null,[this.setFadeOut.bind(this),10,10]),new DEMO.Sequence("cylinders3",this.introAccessor,11700,12500,"0",!0,null,[this.setFadeOut.bind(this),10,20]),new DEMO.Sequence("aqua1",this.plainAccessor,0,1e3,"15",!1,null,[this.setFadeOut.bind(this),0,10]),new DEMO.Sequence("aqua2",this.plainAccessor,5300,6400,"15",!1,null,[this.setFadeOut.bind(this),10,10]),new DEMO.Sequence("aqua3",this.plainAccessor,11600,13700,"15",!1,null,[this.setFadeOut.bind(this),10,20]),new DEMO.Sequence("loops3",this.plainNbAccessor,6600,8400,"19",!0,{6650:new e(4,6.5,8.5,60,720,60),7500:new e(5,6.5,8.5,60,720,60),8500:new e(6,6.7,7.5,60,360,60)},[this.setFadeOut.bind(this),10,20]),new DEMO.Sequence("loops1",this.plainNbAccessor,0,1200,"19",!1,{100:new e(7,7,9,60,420,60),800:new e(8,7,6,60,180,60)},[this.setFadeOut.bind(this),20,10]),new DEMO.Sequence("space1",this.introAccessor,0,2200,"16",!0,null,[this.setFadeOut.bind(this),20,10]),new DEMO.Sequence("space2",this.introAccessor,10750,12200,"16",!1,{11800:new e(9,7,2,60,180,60)},[this.setFadeOut.bind(this),10,20]),new DEMO.Sequence("i3",this.accessor,200,9e3,"5",!1,{200:new d(1,90,0,1320),1600:new b([3e3,"A GOOD TIME",2e-4,new THREE.Vector3(-.1243365386962891,-3.0198771484954836,.03440622655987739),new THREE.Vector3(0,0,0)]),2e3:new b([3e3,"FOR SOME",2e-4,new THREE.Vector3(-.223,-3.12,.047),new THREE.Vector3(0,0,40)]),2250:new b([3e3,"GREETINGS",7e-4,new THREE.Vector3(-.143,-3.87,.447),new THREE.Vector3(180,160,-140)]),2300:new c([4600,new THREE.Vector3(.1289,-3.8176,.8162)]),3150:new c([1500,new THREE.Vector3(-.1243,-2.8198,.0244)]),3750:new c([1500,new THREE.Vector3(-.1543,-2.8198,.0444)]),4180:new c([1500,new THREE.Vector3(.0143,-2.9598,.1344)]),7200:new c([1500,new THREE.Vector3(.53489,-3.4876,.611)]),7220:new c([1500,new THREE.Vector3(.63489,-3.3876,.511)]),7280:new c([1500,new THREE.Vector3(.43489,-3.1876,.65)])},[this.setFadeOut.bind(this),20,20]),new DEMO.Sequence("bubbles",this.introAccessor,10300,12600,"6",!1,null,[this.setFadeOut.bind(this),20,0]),new DEMO.Sequence("rings2",this.plainAccessor,9600,10300,"34",!1,null,[this.setFadeOut.bind(this),20,20]),new DEMO.Sequence("rings",this.plainAccessor,1850,3400,"33",!1,null,[this.setFadeOut.bind(this),20,20]),new DEMO.Sequence("armour1",this.plainAccessor,5e3,6400,"18",!0,null,[this.setFadeOut.bind(this),20,0]),new DEMO.Sequence("armour2",this.plainAccessor,2500,3300,"18",!0,null,[this.setFadeOut.bind(this),0,10]),new DEMO.Sequence("asym1",this.plainAccessor,0,2200,"17",!1,null,[this.setFadeOut.bind(this),10,10]),new DEMO.Sequence("2d green",this.introAccessor,2280,3500,"9",!1,null,[this.setFadeOut.bind(this),0,10]),new DEMO.Sequence("2d green pink",this.introAccessor,5e3,5800,"9",!1,null,[this.setFadeOut.bind(this),10,10]),new DEMO.Sequence("2d max colors",this.introAccessor,11600,12600,"9",!1,null,[this.setFadeOut.bind(this),10,10]),new DEMO.Sequence("2d arcs",this.introAccessor,8570,11e3,"12",!0,null,[this.setFadeOut.bind(this),10,10]),new DEMO.Sequence("2d noise blueish",this.introAccessor,7800,8400,"10",!1,null,[this.setFadeOut.bind(this),10,10]),new DEMO.Sequence("2d green blue purp",this.introAccessor,10700,11e3,"10",!1,null,[this.setFadeOut.bind(this),10,10]),new DEMO.Sequence("2d cyan",this.introAccessor,7800,8100,"13",!1,{8e3:new d(0,90,90,500)},[this.setFadeOut.bind(this),10,10]),new DEMO.Sequence("2d cyan pink",this.introAccessor,5500,5800,"13",!1,{5500:new e(10,7,5,60,360,60)},[this.setFadeOut.bind(this),10,10]),new DEMO.Sequence("2d green",this.introAccessor,10750,11200,"13",!1,null,[this.setFadeOut.bind(this),10,0])]),this.overlayHolder=new DEMO.OverlaySceneHolder(1,1)},Main.prototype={doUpdateKleinianScene:function(a,b,c,d){var e=this.keyFrameHolder.getKeyFrame(c).copy(d);this.kleinianSceneHolder.configure(b,e),this.overlayHolder.setAllInvisible(),this.soundVisualsEnabled=!0},setFadeOut:function(a){this.filmPass.uniforms.fadeOut.value=a},addOverlaySceneContent:function(){this.overlayHolder.resetScreenSize(this.defaultWidth,this.defaultHeight);var a=this.overlayHolder.getScene();this.bannerText=new DEMO.BannerText(a);var b={width:this.defaultWidth,height:this.defaultHeight,switchEffect:1,selectedPageId:1,posX:5.3,posY:5.4,posZ:2.66,xEff:8,yEff:-4,effect:.01,opacity:1,colorOverride:.01,zoom:0};this.scrollTexts=new UTIL.Text(DATA.TextPages,a,b),this.scrollTexts.configureTextPage(0,b.selectedPageId,b.posX,b.posY,b.switchEffect)},addShadowSceneContent:function(){var a=this.kleinianSceneHolder.getShadowScene();this.background=new DEMO.Background(a,this.backgroundColor),this.greets=new DEMO.Greets(a),this.confetti=new DEMO.Confetti(a,this.renderer),this.debugCameraPath&&BOX2.createCameraPath(a,this.keyFrameHolder.getKeyFrames()),this.xsmiley=new DEMO.ExtrudedSvgObject(a,DATA.createXSmiley,0,34e-7,new THREE.Vector3(-45,0,45),new THREE.Vector3(-.1233365386962891,-2.9771484954834,.03440622655987739)),this.android=new DEMO.ExtrudedSvgObject(a,DATA.createAndroid,.2,8e-6,new THREE.Vector3(270,110,0),new THREE.Vector3(.1189365386962891,-3.80763484954834,.19162265598773956)),this.revLogo=new DEMO.ExtrudedSvgObject(a,DATA.createRevision,.5,6e-6,new THREE.Vector3(0,0,0),new THREE.Vector3(.1389365386962891,-3.90763484954834,.00162265598773956))},getEffectComposer:function(a){var b=new DEMO.MultiTargetEffectComposer(this.renderer,a),c=this.kleinianSceneHolder.getShaderPass(a.texSize.x,a.texSize.y);c.renderToScreen=!1,c.needsSwap=!1,b.addPass(c);var d=b.sameTarget(this.kleinianSceneHolder.getShadowRenderPass());b.addPass(d);var e=b.sameTarget(this.overlayHolder.getRenderPass());b.addPass(e),this.glowPass=b.swapTarget(new DEMO.GlowPass),b.addPass(this.glowPass);var f=b.swapTarget(new DEMO.RaysPass(new THREE.Vector2(.2,.75),.012,.4,.99,1));b.addPass(f);var g=b.swapTarget(this.dofPass),h=this;return g.preProcess=function(a){h.dofSamplerPass.render(h.renderer,h.dofPass.getSamplerTarget(),a)},b.addPass(g),this.filmPass.renderToScreen=!0,b.addPass(this.filmPass),b},start:function(){return this.perfStats=new UTIL.FpsStats,window.music=new UTIL.MP3Music(["03 - Wright & Bastard - Dark Gray_.mp3","Ashley Walbridge Arica(Darkmelo Edit)_.mp3"],function(){this.musicIsReady=!0}.bind(this)),THREE.useEarcutTriangulation(),this.canvas=$("#"+this.canvasId)[0],this.defaultWidth=this.canvas.width,this.defaultHeight=this.canvas.height,this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,alpha:!0,preserveDrawingBuffer:!0,autoClearDepth:!1}),this.renderer.autoClear=!1,this.renderer.extensions.get("EXT_frag_depth")?this.renderer.extensions.get("WEBGL_draw_buffers")?(this.target=getRenderTarget(this.defaultWidth,this.defaultHeight),this.kleinianSceneHolder=new BOX2.RawShaderSceneHolder(this.renderer,this.FOV_X,this.FOV_Y,this.backgroundColor,this.getShaderConfigLib()),this.addShadowSceneContent(),this.addOverlaySceneContent(),this.composer=this.getEffectComposer(this.target),this.resize(!0),this.startUserInputHander(),NProgress.start(),void this.render(0)):void alert("error: WEBGL_draw_buffers not available"):void alert("error: EXT_frag_depth not available")},getShaderConfigLib:function(){return BOX2.lib="lib"in BOX2?BOX2.lib:new BOX2.PKleinLib,BOX2.lib.effects},startUserInputHander:function(){new UTIL.Controls({preventDefault:function(){return this.mode!=DEMO.DemoMode.ANIMATION}.bind(this),keyDown:function(a,b){switch(a){case 13:console.log("frame: "+this.player.getDbgInfo())}}.bind(this),keyPress:function(a,b){}.bind(this),rotation:function(a,b,c,d,e){}.bind(this),mouseWheel:function(a){}.bind(this)},this.canvasId,this.fullscreenToggle.bind(this))},stfu:function(a){var b=console.warn;console.warn=function(){},a.bind(this)(),console.warn=b},isReady:function(){if(!this.initInProgress)return this.bannerText.isReady();this.stfu(function(){var a=this.kleinianSceneHolder.incrementalPrecompile(this.renderer);return NProgress.inc(1/this.kleinianSceneHolder.getPrecompileSteps()),!!a&&(this.composer.render(),NProgress.done(),this.initInProgress=!1,!0)})},animateSoundEffect:function(a){this.intensity=.94*this.intensity,this.soundVisualsEnabled&&this.beatDetector.detect(a)&&(this.intensity=.6),this.filmPass.uniforms.nIntensity.value=this.intensity},renderDemo:function(a){0==this.timeOffset&&(this.timeOffset=a,this.player.restart(a)),a-=this.timeOffset,this.mode==DEMO.DemoMode.ANIMATION?this.player.setupAnimationFrame(this.perfStats.getFps())&&(this.mode=DEMO.DemoMode.RANDOM):(this._randomKey=void 0!==this._randomKey?this._randomKey:this.kleinianSceneHolder.getRandomMaterialKey(),this._randomChangeTime=void 0!==this._randomChangeTime?this._randomChangeTime:a,a-this._randomChangeTime>5e3&&(this._randomKey=this.kleinianSceneHolder.getRandomMaterialKey(),this._randomChangeTime=a),this.kleinianSceneHolder.configure(this._randomKey,this.keyFrameHolder.keyFrameForward())),this.animateSoundEffect(music.getFrequencyData()),this.stfu(function(){this.composer.render()})},render:function(a){requestAnimationFrame(this.render.bind(this)),this.isReady()&&(null==this.count?(this.count=0,this.stfu(function(){this.composer.render()})):this.musicIsReady&&(this.count++,this.perfStats.begin(),this.renderDemo(a),this.perfStats.end()))},resize:function(a){var b=this.renderer.domElement,c=1,d=b.clientWidth*c,e=b.clientHeight*c;(a||d!=b.width||e!=b.height)&&this.renderer.setSize(d,e,!1)},fullscreenToggle:function(a){var b,c,d=this.renderer.domElement;a?(b=window.screen.availWidth,c=window.screen.availHeight):(b=this.defaultWidth,c=this.defaultHeight),d.clientWidth=b,d.clientHeight=c;var e=$("#"+this.canvasId)[0];e.width=b,e.height=c,e.style.width=b+"px",e.style.height=c+"px",this.resize(!0),this.target=getRenderTarget(b,c),this.overlayHolder.resetScreenSize(b,c),this.scrollTexts.resetScreenSize(b,c),this.composer=this.getEffectComposer(this.target)}};